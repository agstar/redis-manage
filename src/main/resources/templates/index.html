<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>redis-manage</title>
    <!--<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->

    <link rel="stylesheet" href="../static/plugins/element-ui/index.2.4.11.css"
          th:href="@{plugins/element-ui/index.2.4.11.css}">
    <style>
        .el-header {
            background-color: #B3C0D1;
            color: #333;
            line-height: 60px;
        }

        .el-aside {
            color: #333;
        }
    </style>
</head>
<body>
<div id="app">
    <el-container style="height: 950px; border: 1px solid #eee">
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)">
            <el-menu>
                <el-submenu :index="index" v-for="(value,key,index) in serverKeys" v-index="index">
                    <template slot="title"><i class="el-icon-message"></i>{{key}}</template>
                    <el-menu-item :index="index+'-'+itemIndex" v-for="(itemValue,itemIndex) in value"
                                  v-index="itemIndex">{{itemValue}}
                    </el-menu-item>
                </el-submenu>
            </el-menu>
        </el-aside>
        <el-container>
            <el-header style="text-align: right; font-size: 12px">
                <el-button type="primary" @click="dialogFormVisible = true">添加redis</el-button>
                <el-button type="primary">删除redis</el-button>
                <el-button type="primary">修改redis</el-button>
            </el-header>

            <el-main>
                <el-form>
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item :label="keyType.toUpperCase()+':'">
                                <el-col :span="18">
                                    <el-input v-model="keyName"></el-input>
                                </el-col>
                            </el-form-item>
                        </el-col>
                        <el-col :span="2">
                            <el-form-item label="TTL:">
                                <span>-1</span>
                            </el-form-item>
                        </el-col>
                        <el-col :span="2">
                            <el-form-item>
                                <el-button>Rename</el-button>
                            </el-form-item>
                        </el-col>
                        <el-col :span="2">
                            <el-form-item>
                                <el-button>Delete</el-button>
                            </el-form-item>
                        </el-col>
                        <el-col :span="3">
                            <el-form-item>
                                <el-button>Reload Value</el-button>
                            </el-form-item>
                        </el-col>
                        <el-col :span="2">
                            <el-form-item>
                                <el-button>Set TTL</el-button>
                            </el-form-item>
                        </el-col>
                    </el-row>
                </el-form>
                <el-row>
                    <el-col :span="12">
                        Value:
                    </el-col>
                    <el-col :span="12">
                        View as:
                        <template>
                            <el-select v-model="viewType">
                                <el-option
                                        v-for="item in viewTypeItem"
                                        :key="item"
                                        :label="item"
                                        :value="item">
                                </el-option>
                            </el-select>
                        </template>
                    </el-col>
                </el-row>
                <el-row>
                    <el-input type="textarea" v-model="value" rows="15"></el-input>
                </el-row>
                <el-row>
                    <el-button style="float:right;">Save</el-button>
                </el-row>
                <el-row style="margin:10px;">
                    <el-input type="textarea" v-model="value" rows="15"></el-input>
                </el-row>
            </el-main>
        </el-container>
    </el-container>
    <el-dialog title="添加redis" :visible.sync="dialogFormVisible">
        <el-form :model="server">
            <el-form-item label="连接名称" :label-width="formLabelWidth">
                <el-input v-model="server.name" autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item label="host" :label-width="formLabelWidth">
                <el-input v-model="server.host" autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item label="端口" :label-width="formLabelWidth">
                <el-input v-model="server.port" type="number" autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item label="密码" :label-width="formLabelWidth">
                <el-input v-model="server.auth" autocomplete="off"></el-input>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button type="success">测试连接</el-button>
            <el-button type="primary" @click="addServer">确 定</el-button>
            <el-button @click="dialogFormVisible = false">取 消</el-button>
        </div>
    </el-dialog>
</div>
</body>
<script th:src="@{plugins/vue/vue.2.5.21.js}" src="../static/plugins/vue/vue.2.5.21.js"></script>
<script th:src="@{plugins/element-ui/index.2.4.11.js}" src="../static/plugins/element-ui/index.2.4.11.js"></script>
<script src="../static/plugins/axios/axios.min.js" th:src="@{plugins/axios/axios.min.js}"></script>
<script>
    var vm = new Vue({
        el: "#app",
        data: {
            head: 'headersss',
            main: 'main',
            aside: 'Aside',
            keyName: 'redisKey',
            value: 'asdfffffffffffffffffjkalsjdklfjaskldjfkljasdkljfklasjdklfjklsjdkfljklsadjfkljsdfjas' +
            'djfkjsdkfjlskajdflsjdlfjlskdjflkajsdfkljslkdjflksjdflkjsdlkjflkasdjflkjasdkfjlkasdjflkjasdlkf',
            viewType: 'JSON',
            viewTypeItem: ['JSON', 'TEXT'],
            keyType: 'string',
            dialogFormVisible: false,
            server: {
                name: '',
                host: '',
                port: 6379,
                auth: ''
            },
            formLabelWidth: '120px',
            serverKeys: [],
            serverList: []
        },
        methods: {
            addServer() {
                var $this = this;
                axios.post('/server', this.server)
                    .then(function (response) {
                        $this.$message({
                            message: response.data.message,
                            type: response.data.flag ? 'success' : 'error'
                        });
                        console.log(response);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
                $this.dialogFormVisible = false;
                // this.clearServer();
            },
            clearServer() {
                this.server = {
                    name: '',
                    host: '',
                    port: 6379,
                    auth: ''
                }
            },
            getServer() {
                var $this = this;
                axios.get('/server', this.server)
                    .then(function (response) {
                        $this.serverList = response.data.data;
                        $this.$set($this.serverList, 'showEditBtn', true);
                        $this.$message({
                            message: response.data.message,
                            type: response.data.flag ? 'success' : 'error'
                        });
                        console.log(response);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
                $this.dialogFormVisible = false;
                // this.clearServer();
            },
            getKeys(servername) {
                var $this = this;
                axios.get('/key', this.server)
                    .then(function (res) {
                        if (res.data.flag) {
                            $this.serverKeys = res.data.data;
                        }
                        $this.$message({
                            message: res.data.message,
                            type: res.data.flag ? 'success' : 'error'
                        });
                        console.log(res);
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
                $this.dialogFormVisible = false;
            }
        }
    })
</script>
</html>